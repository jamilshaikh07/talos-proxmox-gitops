apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboard-kubernetes-events
  namespace: monitoring
  labels:
    grafana_dashboard: "1"
data:
  kubernetes-events.json: |
    {
      "annotations": {
        "list": [
          {
            "builtIn": 1,
            "datasource": "-- Grafana --",
            "enable": true,
            "hide": true,
            "iconColor": "rgba(0, 211, 255, 1)",
            "name": "Annotations & Alerts",
            "type": "dashboard"
          }
        ]
      },
      "editable": true,
      "gnetId": null,
      "graphTooltip": 0,
      "id": null,
      "links": [],
      "panels": [
        {
          "datasource": "Loki",
          "gridPos": {
            "h": 8,
            "w": 24,
            "x": 0,
            "y": 0
          },
          "id": 2,
          "options": {
            "showLabels": false,
            "showTime": true,
            "sortOrder": "Descending",
            "wrapLogMessage": true
          },
          "targets": [
            {
              "expr": "{app=\"kubernetes-events\", cluster=\"homelab\"} |= \"$namespace\" | json",
              "refId": "A"
            }
          ],
          "title": "Kubernetes Events (All Namespaces)",
          "type": "logs"
        },
        {
          "datasource": "Loki",
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 0,
            "y": 8
          },
          "id": 3,
          "options": {
            "showLabels": false,
            "showTime": true,
            "sortOrder": "Descending",
            "wrapLogMessage": true
          },
          "targets": [
            {
              "expr": "{app=\"kubernetes-events\"} |~ \"Warning|Error|Failed\"",
              "refId": "A"
            }
          ],
          "title": "Warning & Error Events",
          "type": "logs"
        },
        {
          "datasource": "Loki",
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 12,
            "y": 8
          },
          "id": 4,
          "options": {
            "showLabels": false,
            "showTime": true,
            "sortOrder": "Descending",
            "wrapLogMessage": true
          },
          "targets": [
            {
              "expr": "{app=\"kubernetes-events\"} |~ \"Pod\" |~ \"$namespace\"",
              "refId": "A"
            }
          ],
          "title": "Pod Events (Selected Namespace)",
          "type": "logs"
        }
      ],
      "schemaVersion": 27,
      "style": "dark",
      "tags": ["kubernetes", "events", "loki"],
      "templating": {
        "list": [
          {
            "current": {
              "selected": false,
              "text": "monitoring",
              "value": "monitoring"
            },
            "hide": 0,
            "includeAll": false,
            "label": "Namespace",
            "multi": false,
            "name": "namespace",
            "options": [
              {"text": "argocd", "value": "argocd"},
              {"text": "cert-manager", "value": "cert-manager"},
              {"text": "kube-system", "value": "kube-system"},
              {"text": "longhorn-system", "value": "longhorn-system"},
              {"text": "minio-system", "value": "minio-system"},
              {"text": "monitoring", "value": "monitoring"},
              {"text": "traefik-system", "value": "traefik-system"}
            ],
            "query": "argocd,cert-manager,kube-system,longhorn-system,minio-system,monitoring,traefik-system",
            "skipUrlSync": false,
            "type": "custom"
          }
        ]
      },
      "time": {
        "from": "now-1h",
        "to": "now"
      },
      "timepicker": {},
      "timezone": "",
      "title": "Kubernetes Events",
      "uid": "kubernetes-events",
      "version": 1
    }
